\documentclass[letter, 9pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, amsthm}
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{listings}
\usepackage{xcolor}
\usepackage[left=1.7cm, right=2.2cm, top=2.2cm, bottom = 2.2cm]{geometry}

\title{CSC343 Assignment1}
\author{Haoda Li, Xinyi Liu, Kewei Qiu}

\begin{document}

\maketitle
\section*{Part I}
\begin{enumerate}
    \item {\color{gray} \# \textit{Find all (uid1, uid2) tuples such that user1 ever liked user2's posts} .\\}
    LikeUidsTuple(uid1,uid2) := $\rho_{\text{(uid1, uid2)}}$($\Pi_{\text{liker, uid} }$ (Likes $\bowtie$ Post)) 
   
    {\color{gray} \# \textit{Find all uid1 such that user1 liked user2's post and also follows user2}\\}
    LikeAndFollowUids(uid1) := $\Pi_{\text{uid1}}$(LikeUidsTuple $\cap$ $\rho_{\text{(uid1, uid2)}}$($\Pi_{\text{follower, followed}}$ (Follows))) 
    
    {\color{gray} \# \textit{Find all uid1 such that user1 liked user2's post but doesn't follow user2}\\}
    LikeAndUnfollowUids(uid1) := $\Pi_{\text{uid1}}$(LikeUidsTuple) - LikeAndFollowUids
    
    {\color{gray} \# \textit{Find all uid such that user1 have never liked a post of a user that they do not follow}\\}
    NeverLikeFollowingUids(uid1) := $\Pi_{\text{uid}}$(User) - LikeAndUnfollowUids 
    
    {\color{gray} \# \textit{Find all (uid1, uid2) tuples such that that user1 ever viewed user2's stories} .\\}
    ViewUidsTuple(uid1,uid2) := $\rho_{\text{(uid1, uid2)}}$($\Pi_{\text{viewerid, uid} }$ (Saw $\bowtie$ Story)) 
   
    {\color{gray} \# \textit{Find all uid1 such that user1 viewed user2's stories and also follows user2}\\}
    ViewAndFollowUids(uid) := $\Pi_{\text{uid1}}$(ViewUidsTuple $\cap$ $\rho_{\text{(uid1, uid2)}}$($\Pi_{\text{follower, followed}}$ (Follows))) 
    
    {\color{gray} \# \textit{Find all uid1 such that user1 viewed user2's story but doesn't follow user2}\\}
    ViewAndUnfollowUids(uid1) := $\Pi_{\text{uid1}}$(ViewUidsTuple) - ViewAndFollowUids
    
    {\color{gray} \# \textit{Find all uid such that user1 have never viewed a story of a user that they do not follow}\\}
    NeverViewFollowingUids(uid1) := $(\Pi_{\text{uid}}$(User)) - ViewAndUnfollowUids 
    
    {\color{gray} \# \textit{Find all uid such that user1 have never liked or viewed a post or a story of a user that they do not follow}\\}
    AnswerUids(uid) := NeverLikeFollowingUids $\cup$ NeverViewFollowingUids 
    
    {\color{gray} \# \textit{Report the selected uid's name and about as username and description} \\}
    Answer(username, description) := $\rho_{\text{(username, description)}}$($\Pi_{\text{name, about}}(\text{User}\bowtie \text{AnswerUids})$)
    
    
    \item {\color{gray} \# \textit{Match posts and hashtag they mentioned in captions in 2018} \\}
    PostIn18(pid, when, tag) := $\Pi_{\text{pid, when, tag}}$
    (($\sigma_{\text{when.year = 2018}}$ (Post)) $\bowtie$ (Hashtag))
    
    {\color{gray} \# \textit{Find all pairs of posts which have the same hashtag in the same day in 2018} \\}
    PostPairsIn18(P1.pid, P2.pid, when, tag) := $\sigma_{\text{(P1.pid $<$ P2.pid)} \land \text{(P1.tag = P2.tag)} \land \text{(P1.when.date = P2.when.date)}}$ \\
    ($\rho_{\text{P1}}$ (PostIn18) $\times$ $\rho_{\text{P2}}$ (PostIn18))
    
    {\color{gray} \#\textit{Pick out tags} \\}
    Result(tag) := $\Pi_{\text{tag}}$ (PostPairsIn18)
    
    \item {\color{gray} \# \textit{Find all "reciprocal followers"}} \\
    Reciprocal(r1, r2) := $\Pi_{\text{uid1, uid2}} ($($\rho_{\text{F1(uid1, uid2)}}$(Follows))$\bowtie_{uid1 = uid4\land uid2 = uid3}$ ($\rho_{\text{F2(uid3, uid4)}}$(Follows)))
    
    {\color{gray} \# \textit{Find all uncommon follower's uids}} \\
    Uncommon(uid, r1, r2):= $\Pi_{\text{follower, r1, r2}}$ \\
    (Follows $\bowtie_{\text{follower $\neq$ r1} \land \text{follower $\neq$ r2} \land 
                      ((\text{followed = r1}\land \text{followed $\neq$ r2}) \lor
                       (\text{followed $\neq$ r1}\land \text{followed = r2}))}$ Reciprocal) 
    
    {\color{gray} \# \textit{Report the uncommon follower's uid, name, email, and the pair of reciprocal follower's uids}} \\
    Result(uncommon\_uid, name, email, r1\_uid, r2\_uid) := $\Pi_{\text{uid, name, email, r1, r2}}$(Uncommon $\bowtie$ User)
    
    \item Cannot be expressed

    \item {\color{gray} \# \textit{Find all the pairs of users that user1 does not like all of user2's post}} \\
    Unlikes(uid1,uid2):=
    $\Pi_{\text{liker,uid}}$
    (
        Post $\times$ $\rho_{\text{L(liker)}}$ ($\Pi_{\text{uid}}$(User)) $-$ 
        Post $\bowtie$ $\Pi_{\text{uid,liker}}$(Likes)
    ) 
    
    {\color{gray} \# \textit{Find all the pairs of users that user1 follows user2 and likes all users'2 posts}} \\
    FL(uid1, uid2):= $\rho_{\text{uid1,uid2}}$($\Pi_{\text{follwer, followed}}$(Follows)) $-$ Unlikes
    
    {\color{gray} \# \textit{Find all pairs of “backscratchers”}} \\
    Back(b1, b2) := $\Pi_{\text{uid1,uid2}}$($\rho_{\text{FL1(uid1,uid2)}}$(FL) $\bowtie_{\text{uid1 = uid4}\land \text{uid2 = uid3}}$ $\rho_{\text{FL2(uid3,uid4)}}$(FL)) 
    
    
    {\color{gray} \# \textit{Report the user id of all users who follow some pair of backscratcher users} \\}
    Result(uid) := $\Pi_{\text{F1.uid1}}$($\sigma_{\text{F1.uid1}=\text{F2.uid1} \land \text{F1.uid2} = \text{b1}\land \text{F2.uid2} = \text{b2}}$($\rho_{\text{F1}}$(Follows)$\times$ Back $\times$ $\rho_{\text{F2}}$(Follows)))
    
    \item {\color{gray} \# \textit{Get all users' most recent activity}} \\
    Action(uid, when) := $\Pi_{\text{uid, when}}$ (Post) $\cup$ $\Pi_{\text{uid, when}}$ (Story) \\
    NotMostRecentAction(uid, when) := $\Pi_{\text{A1.uid, A1.when}}$ ($\sigma_{(\text{A1.uid} = \text{A2.uid}) \land (\text{A1.when} < \text{A2.when})}$  ($\rho_{\text{A1}}$ (Action) $\times$ \\ $\rho_{\text{A2}}$ (Action))) \\
    MostRecentAction(uid, when) := Action - NotMostRecentAction \\
    
    {\color{gray} \# \textit{Get uids of each users' most rencent activity user}} \\
    FollowedAction(follower, followed, when) :=$\Pi_{\text{follower, followed, when}}$ (Follows $\bowtie_{\text{followed=uid}}$ MostRecentAction) \\
    NotMostRecent(follower, followed, when) := $\Pi_{\text{F1.follower, F1.followed, F1.when}}$ ($\sigma_{(\text{F1.follower} = \text{F2.follower}) \land (\text{F1.when} < \text{F2.when})}$ \\ ($\rho_{\text{F1}}$ (FollowedAction) $\times$ $\rho_{\text{F2}}$ (FollowedAction)) \\
    MostRecent(follower, followed, when) := FollowedAction - NotMostRecent) \\
    
    {\color{gray} \# \textit{Report the required information}} \\
    FollowerInfo(follower, followerName) := $\Pi_{\text{uid, name}}$ (User) \\
    FollowedInfo(followed, followedName, email) := $\Pi_{\text{uid, name, email}}$(User) \\
    Result(followerName, followedName, email, when) := \\$\Pi_{\text{followerName, followedName, email, when}}$(MostRecent $\bowtie$ FollowerInfo $\bowtie$ FollowedInfo) 
    
    \item Cannot be expressed
    
    \item {\color{gray} \# \textit{Remove attribute text from relation Comment}} \\
    NoText(pid, commenter, when) := $\Pi_{\text{pid, commenter, when}}$ (Comment) 
    
    {\color{gray} \# \textit{Create a relation about each pairs of comments of each commenter}} \\
    CommentPairs(N1.pid, N2.pid, commenter, N1.when, N2.when) := $\sigma_{\text{N1.pid $<$ N2.pid}}$ ($\rho_{\text{N1(N1.pid, commenter, N1.when)}}$ (NoText) $\bowtie$ $\rho_{\text{N2(N2.pid, commenter, N2.when)}}$ (NoText)) 
    
    {\color{gray} \# \textit{Choose comments which are not first posted by each commenter}} \\
    NotFirst(pid, commenter) := $\Pi_{\text{N1.pid, commenter}}$ ($\sigma_{\text{N1.when $>$ N2.when}}$ (CommentPairs)) 
    
    {\color{gray} \# \textit{Choose comments which are not last posted by each commenter}} \\
    NotLast(pid, commenter) := $\Pi_{\text{N1.pid, commenter}}$ ($\sigma_{\text{N1.when $<$ N2.when}}$ (CommentPairs)) 
    
    {\color{gray} \# \textit{Remove "not first posted list" from comments list to get first post for each commenter}} \\
    First(first, commenter) := ($\Pi_{\text{pid, commenter}}$ (Comments)) - NotFirst
    
    {\color{gray} \# \textit{Remove "not last posted list" from comments list to get last post for each commenter}} \\
    Last(last, commenter) := ($\Pi_{\text{pid, commenter}}$ (Comments)) - NotLast
    
    {\color{gray} \# \textit{Use natural join to get relation about each commenters and their first and last post}} \\
    Result(first, last, commenter) := First $\bowtie$ Last
\end{enumerate}

\section*{Part II}
\begin{enumerate}
    \item $\sigma_{(\text{S.sid = V.sid}) \land (\text{S.when $>$ V.when)}} (\rho_{\text{S}} (\text{Story}) \times \rho_{\text{V}} (\text{Saw})) = \emptyset $
    
    \item $\sigma_{(\text{S1.sid $<$ S2.sid}) \land (\text{S1.uid = S2.uid}) \land (\text{S1.when = S2.when}) \land (\text{S1.current = S2.current = True)}} ((\rho_{\text{S1}} (\text{Story})) \times (\rho_{\text{S2}} (\text{Story}))) = \emptyset$

\end{enumerate}

\end{document}
